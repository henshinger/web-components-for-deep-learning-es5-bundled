<html><head><link rel="import" href="../bower_components/polymer/polymer-element.html"><link rel="import" href="../bower_components/paper-button/paper-button.html"><link rel="import" href="../bower_components/paper-progress/paper-progress.html"><link rel="import" href="../bower_components/iron-icons/iron-icons.html"><link rel="import" href="../bower_components/iron-icon/iron-icon.html"><script src="../lib/webdnn.js"></script><link rel="import" href="shared-styles.html"></head><body><dom-module id="anime-image-uploader"><template><style include="shared-styles">:host{display:flex;align-self:center;align-items:center;flex-flow:column;}#imageCanvas{margin-top:10px;display:block;height:224;width:224;}paper-button{margin:5px;}paper-button.pink{color:var(--paper-pink-500);--paper-icon-button-ink-color:var(--paper-indigo-500);}paper-button.pink:hover{background-color:var(--paper-pink-500);color:white;}#imageLoader{opacity:0;height:0px;width:0px;}paper-progress.pink{--paper-progress-active-color:var(--paper-pink-500);--paper-progress-secondary-color:var(--paper-pink-100);}</style><template is="dom-if" if="{{!loaded}}"><paper-progress value="{{progress}}" class="pink"></paper-progress></template><template is="dom-if" if="{{loaded}}"><canvas id="imageCanvas" height="{{height}}" width="{{width}}" on-submitimage="loaded"></canvas><span>{{message}}</span><paper-button raised="" class="uploadButton pink" on-click="triggerUpload"><iron-icon icon="file-upload"></iron-icon>Upload</paper-button><input type="file" id="imageLoader" name="imageLoader" on-change="loadImage" accept="image/*"><template is="dom-if" if="{{isAnime}}"><paper-button raised="" on-click="submitImage" class="pink"><iron-icon icon="favorite"></iron-icon></paper-button></template></template></template><script>class AnimeImageUploader extends Polymer.Element{static get is(){return'anime-image-uploader'}static get properties(){return{progress:{type:Number,value:0},loaded:{type:Boolean,computed:'computeLoaded(progress)'},imageData:{type:String,value:''},animeProbability:{type:Number,value:0},finishedComputing:{type:Boolean,value:!1},firstTime:{type:Boolean,value:!0},message:{type:String,computed:'computeMessage(finishedComputing, animeProbability, firstTime)'},isAnime:{type:Boolean,computed:'computeIsAnime(message)'},height:{type:Number,computed:'computeHeight(imageData)'},width:{type:Number,computed:'computeWidth(imageData)'}}}async ready(){super.ready(),this.runner=await WebDNN.load('lib/output_keras',{progressCallback:(a,b)=>this.set('progress',100*a/b)})}computeLoaded(a){return 100==a}computeHeight(a){return''==a?0:224}computeWidth(a){return''==a?0:224}computeMessage(a,b,c){return c?'':a?a?0.5<b?'Ah, I see you\u2019re a man of culture as well':'ANIME JA NAI!!!':void 0:'Doing some deep thinking...'}computeIsAnime(a){return'Ah, I see you\u2019re a man of culture as well'==a}triggerUpload(){this.shadowRoot.querySelector('#imageLoader').click()}async getImageFromFile(a){return new Promise(b=>{let d=new FileReader;d.onload=f=>{b(f.target.result)},d.readAsDataURL(a)})}submitImage(){let a=new CustomEvent('submitImage',{bubbles:!0,composed:!0,detail:{imageData:this.imageData}});this.dispatchEvent(a),this.set('imageData',''),this.set('firstTime',!0)}async loadImage(a){let b=await this.getImageFromFile(a.target.files[0]);this.set('imageData',b);let c=await WebDNN.Image.getImageArray(b,{dstW:224,dstH:224});WebDNN.Image.setImageArrayToCanvas(c,224,224,this.shadowRoot.querySelector('#imageCanvas')),this.set('firstTime',!1),this.run()}async run(){this.runner.getInputViews()[0].set((await WebDNN.Image.getImageArray(this.shadowRoot.querySelector('#imageCanvas'),{order:WebDNN.Image.Order.HWC,color:WebDNN.Image.Color.BGR,bias:[123.68,116.779,103.939]}))),this.set('finishedComputing',!1),this.set('animeProbability',0),await this.runner.run();let a=this.runner.getOutputViews()[0].toActual();this.set('animeProbability',a[0]),this.set('finishedComputing',!0)}}window.customElements.define(AnimeImageUploader.is,AnimeImageUploader);</script></dom-module></body></html>