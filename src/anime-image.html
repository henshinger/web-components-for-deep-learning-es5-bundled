<html><head><link rel="import" href="../bower_components/polymer/polymer-element.html"><link rel="import" href="../bower_components/paper-progress/paper-progress.html"><link rel="import" href="shared-styles.html"><script src="../lib/webdnn.js"></script></head><body><dom-module id="anime-image-uploader"><template><style include="shared-styles">:host{display:block;padding:10px;margin:auto;}paper-progress{display:block;width:100%;margin:20px 0;}paper-progress.pink{--paper-progress-active-color:var(--paper-pink-500);--paper-progress-secondary-color:var(--paper-pink-100);}#imageCanvas{margin-top:10px;display:block;height:224;width:224;}</style><template is="dom-if" if="{{!loaded}}"><paper-progress value="{{progress}}" class="pink"></paper-progress></template><template is="dom-if" if="{{loaded}}"><canvas id="imageCanvas" height="224" width="224"></canvas></template></template><script>class AnimeImage extends Polymer.Element{static get is(){return'anime-image'}static get properties(){return{progress:{type:Number,value:0},imageData:{type:String,value:0},animeProbability:{type:Number,value:0},finishedComputing:{type:Boolean,value:!1},firstTime:{type:Boolean,value:!0},loaded:{type:Boolean,computed:'computeLoaded(progress)',notify:!0},state:{type:String,computed:'computeState(finishedComputing, animeProbability, firstTime)',notify:!0},isAnime:{type:Boolean,computed:'computeIsAnime(state)',notify:!0}}}async ready(){super.ready(),this.runner=await WebDNN.load('../lib/output_keras',{progressCallback:(a,b)=>this.set('progress',100*a/b)}),this.shadowRoot.addEventListener('loadImage',a=>{this.loadImage(a.detail.dataURL)})}computeLoaded(a){return 100==a}computeState(a,b,c){return c?'loading':a?a?0.5<b?'anime':'notAnime':void 0:'computing'}computeIsAnime(a){return'anime'==a}async loadImage(a){let b=a,c=await WebDNN.Image.getImageArray(b,{dstW:224,dstH:224});WebDNN.Image.setImageArrayToCanvas(c,224,224,this.shadowRoot.querySelector('#imageCanvas')),this.set('firstTime',!1),this.set('imageData',b),this.run()}async run(){this.runner.getInputViews()[0].set((await WebDNN.Image.getImageArray(this.shadowRoot.querySelector('#imageCanvas'),{order:WebDNN.Image.Order.HWC,color:WebDNN.Image.Color.BGR,bias:[123.68,116.779,103.939]}))),this.set('finishedComputing',!1),this.set('animeProbability',0),await this.runner.run();let a=this.runner.getOutputViews()[0].toActual();this.set('animeProbability',a[0]),this.set('finishedComputing',!0)}}window.customElements.define(AnimeImage.is,AnimeImage);</script></dom-module></body></html>